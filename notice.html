<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê³µì§€ì‚¬í•­ | ì–‘ì–‘êµ° ë†ì´Œí™œì„±í™”ì§€ì›ì„¼í„°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:"Noto Sans KR",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      line-height:1.6;
      color:#222;
      background:#f5f5f5;
    }
    a{text-decoration:none;color:inherit;}

    header{
      position:sticky;
      top:0;
      z-index:10;
      background:#ffffffcc;
      backdrop-filter:blur(8px);
      border-bottom:1px solid #e5e5e5;
    }
    .container{
      width:100%;
      max-width:1080px;
      margin:0 auto;
      padding:0 16px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 0;
    }
    .logo{font-weight:700;font-size:1.1rem;}
    .logo span{color:#0b7c5b;}
    .nav-links{display:flex;gap:16px;font-size:0.95rem;}
    .nav-links a{padding:4px 8px;border-radius:999px;}
    .nav-links a:hover{background:#0b7c5b;color:#fff;}

    main{padding:48px 0;}
    .page-title{font-size:1.8rem;font-weight:700;margin-bottom:8px;}
    .page-sub{font-size:0.95rem;color:#555;margin-bottom:24px;}

    .notice-wrapper{
      background:#fff;
      border-radius:16px;
      border:1px solid #e5e5e5;
      padding:16px 18px 20px;
      box-shadow:0 6px 18px rgba(0,0,0,0.03);
    }

    /* ê²€ìƒ‰/í•„í„° ë°” */
    .notice-toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
      font-size:0.85rem;
    }
    .notice-toolbar-left,
    .notice-toolbar-right{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .notice-search-input{
      min-width:220px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #ddd;
      font-size:0.85rem;
    }
    .notice-filter-select{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #ddd;
      font-size:0.85rem;
      background:#fff;
    }

    .notice-table{width:100%;border-collapse:collapse;font-size:0.9rem;table-layout:fixed;}
    .notice-table thead{background:#f5f7f6;}
    .notice-table th,
    .notice-table td{
      padding:10px 8px;
      border-bottom:1px solid #ececec;
      text-align:left;
    }
    .notice-table th:nth-child(2),
    .notice-table td:nth-child(2){
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .notice-table th:nth-child(3),
    .notice-table td:nth-child(3){
      text-align:right;
    }

    .notice-row{cursor:pointer;}
    .notice-row:hover{background:#f4fbf7;}

    .notice-type{
      font-size:0.8rem;
      color:#0b7c5b;
      font-weight:600;
      white-space:nowrap;
    }
    .notice-title{color:#222;}
    .notice-date{
      font-size:0.8rem;
      color:#777;
      white-space:nowrap;
    }
    .notice-empty{
      text-align:center;
      color:#888;
      padding:18px 0;
    }

    /* í˜ì´ì§€ë„¤ì´ì…˜ */
    .notice-pagination{
      margin-top:12px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      font-size:0.85rem;
    }
    .notice-page-btn{
      border:1px solid #ddd;
      background:#fff;
      border-radius:999px;
      padding:4px 10px;
      cursor:pointer;
      font-size:0.8rem;
    }
    .notice-page-btn[disabled]{
      opacity:0.4;
      cursor:default;
    }
    .notice-page-info{
      color:#666;
      font-size:0.85rem;
    }

    footer{
      padding:16px 0 24px;
      background:#111;
      color:#aaa;
      font-size:0.8rem;
      margin-top:40px;
    }
    footer .container{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    footer a{color:#e0f2e9;}

    /* ===== ëª¨ë‹¬ ë””ìì¸ ===== */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .modal.is-open{display:flex;}
    .modal-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.45);
      backdrop-filter:blur(2px);
    }
    .modal-dialog{
      position:relative;
      background:#fff;
      border-radius:18px;
      padding:18px 20px 22px;
      width:min(720px,96vw);
      max-height:90vh;
      box-shadow:0 18px 45px rgba(0,0,0,0.25);
      z-index:1;
      display:flex;
      flex-direction:column;
      gap:10px;
      font-size:0.9rem;
    }
    .modal-title{
      font-size:1.1rem;
      font-weight:700;
      margin-bottom:4px;
    }
    .modal-meta{
      font-size:0.8rem;
      color:#777;
      margin-bottom:8px;
    }

    /* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ì˜ì—­ */
    .modal-images{
      margin:4px 0 6px;
      display:none;          /* ê¸°ë³¸ì€ ìˆ¨ê¹€, ì´ë¯¸ì§€ ìˆì„ ë•Œë§Œ flex */
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .modal-img-frame{
      position:relative;
      flex:1;
      max-height:320px;
      border-radius:12px;
      overflow:hidden;
      background:#f7f7f7;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .modal-img-frame img{
      max-width:100%;
      max-height:320px;
      display:block;
    }
    .modal-img-indicator{
      position:absolute;
      right:8px;
      bottom:8px;
      background:rgba(0,0,0,0.6);
      color:#fff;
      font-size:0.75rem;
      padding:2px 6px;
      border-radius:999px;
    }
    .modal-img-nav{
      border:none;
      background:#f2f2f2;
      width:28px;
      height:28px;
      border-radius:999px;
      cursor:pointer;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .modal-img-nav:hover{background:#e0e0e0;}

    .modal-body{
      flex:1;
      overflow-y:auto;
      padding-right:4px;
      font-size:0.88rem;
      line-height:1.6;
      word-break:keep-all;
    }
    .modal-body a{
      color:#0b7c5b;
      text-decoration:underline;
    }
    .modal-close{
      position:absolute;
      top:10px;
      right:10px;
      border:none;
      background:#f5f5f5;
      width:30px;
      height:30px;
      border-radius:999px;
      cursor:pointer;
      font-size:18px;
      line-height:1;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#666;
    }
    .modal-close:hover{background:#e2e2e2;}

    .modal-link{
      margin-top:10px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 14px;
      border-radius:999px;
      background:#0b7c5b;
      color:#fff;
      font-size:0.85rem;
      font-weight:600;
    }
    .modal-link:hover{background:#096149;}

    @media (max-width:768px){
      .nav-links{display:none;}
      main{padding:32px 0;}
      .page-title{font-size:1.4rem;}
      .notice-table th,
      .notice-table td{
        padding:8px 4px;
        font-size:0.82rem;
      }
      .notice-toolbar{
        align-items:flex-start;
      }
      .notice-search-input{
        flex:1;
        min-width:0;
      }
    }

    @media (max-width:480px){
      .modal-dialog{
        width:94vw;
        padding:16px 14px 18px;
        font-size:0.85rem;
      }
      .modal-title{font-size:1rem;}
      .modal-body{font-size:0.82rem;}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="logo">
        ì–‘ì–‘êµ° <span>ë†ì´Œí™œì„±í™”ì§€ì›ì„¼í„°</span>
      </div>
      <nav class="nav-links">
        <a href="index.html#about">ì„¼í„°ì†Œê°œ</a>
        <a href="index.html#programs">ì£¼ìš”ì‚¬ì—…</a>
        <a href="index.html#teachers">ê°•ì‚¬ì§„</a>
        <a href="notice.html">ê³µì§€ì‚¬í•­</a>
        <a href="index.html#gallery">í™œë™ì‚¬ì§„</a>
        <a href="index.html#contact">ì˜¤ì‹œëŠ”ê¸¸</a>
        <a href="qna.html">Q&A</a>
        <a href="admin.html">ê´€ë¦¬ì</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <h1 class="page-title">ê³µì§€ì‚¬í•­</h1>
      <p class="page-sub">
        ì„¼í„°ì˜ ì£¼ìš” ê³µì§€, ëª¨ì§‘ ì•ˆë‚´, ì¼ì • ë³€ê²½ ë“±ì˜ ë‚´ìš©ì„ í•œ ëˆˆì— ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        ê° í–‰ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>

      <div class="notice-wrapper">
        <!-- ğŸ” ê²€ìƒ‰/í•„í„° ì˜ì—­ -->
        <div class="notice-toolbar">
          <div class="notice-toolbar-left">
            <input
              type="text"
              id="notice-search-input"
              class="notice-search-input"
              placeholder="ì œëª©Â·ë‚´ìš© ê²€ìƒ‰"
            />
          </div>
          <div class="notice-toolbar-right">
            <select id="notice-type-filter" class="notice-filter-select">
              <!-- JSì—ì„œ ì˜µì…˜ ìë™ ìƒì„± -->
            </select>
          </div>
        </div>

        <table class="notice-table">
          <thead>
            <tr>
              <th style="width:80px;">êµ¬ë¶„</th>
              <th>ì œëª©</th>
              <th style="width:120px;">ë‚ ì§œ</th>
            </tr>
          </thead>
          <tbody id="notice-tbody">
            <!-- JSë¡œ ì „ì²´ ê³µì§€ê°€ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
          </tbody>
        </table>

        <!-- ğŸ”¢ í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ -->
        <div class="notice-pagination" id="notice-pagination">
          <!-- JSì—ì„œ ë²„íŠ¼Â·í˜ì´ì§€ ì •ë³´ê°€ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div>Â© <span id="year"></span> ì–‘ì–‘êµ° ë†ì´Œí™œì„±í™”ì§€ì›ì„¼í„°. All rights reserved.</div>
    </div>
  </footer>

  <!-- ===== ê³µì§€ ìƒì„¸ ëª¨ë‹¬ ===== -->
  <div id="noticeModal" class="modal" aria-hidden="true">
    <div class="modal-overlay"></div>
    <div class="modal-dialog">
      <button type="button" class="modal-close" id="modal-close-btn">Ã—</button>
      <div class="modal-title" id="modal-title"></div>
      <div class="modal-meta">
        <span id="modal-type"></span> Â· <span id="modal-date"></span>
      </div>

      <!-- ğŸ–¼ í¬ìŠ¤í„° ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” -->
      <div class="modal-images" id="modal-images">
        <button type="button" class="modal-img-nav" id="modal-img-prev">â€¹</button>
        <div class="modal-img-frame">
          <img id="modal-img" src="" alt="ê³µì§€ ì´ë¯¸ì§€" />
          <div class="modal-img-indicator" id="modal-img-indicator"></div>
        </div>
        <button type="button" class="modal-img-nav" id="modal-img-next">â€º</button>
      </div>

      <div class="modal-body" id="modal-content"></div>
      <a id="modal-link" class="modal-link" href="#" target="_blank" rel="noopener noreferrer">
        ìì„¸íˆ ë³´ê¸° / ê´€ë ¨ ë§í¬ ì—´ê¸°
      </a>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // âœ… ê³µì§€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ CSV URL
    const NOTICE_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTO3geLtt5vZ-bOZiY4vb_Rd48xcQGJyZbmjXcHA1ZDnDmFQWAysgxvD-EumgkalVDlmRgdHfzqIVwf/pub?gid=1610639191&single=true&output=csv";

    let NOTICES = [];            // ì›ë³¸ ê³µì§€ ì „ì²´
    let FILTERED_NOTICES = [];   // ê²€ìƒ‰/í•„í„° ì ìš© í›„ ëª©ë¡
    let currentTypeFilter = "ì „ì²´";
    let currentKeyword = "";
    const PAGE_SIZE = 10;
    let currentPage = 1;

    // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ìƒíƒœ
    let currentImages = [];
    let currentImageIndex = 0;

    // ===== CSV íŒŒì„œ =====
    function parseCSV(text){
      const rows=[];let row=[];let field="";let insideQuotes=false;
      for(let i=0;i<text.length;i++){
        const c=text[i];
        if(c === '"'){
          if(insideQuotes && text[i+1]==='"'){field+='"';i++;}
          else{insideQuotes=!insideQuotes;}
        }else if(c === "," && !insideQuotes){
          row.push(field);field="";
        }else if((c==="\n"||c==="\r") && !insideQuotes){
          if(field!==""||row.length>0){row.push(field);rows.push(row);row=[];field="";}
        }else{
          field+=c;
        }
      }
      if(field!==""||row.length>0){row.push(field);rows.push(row);}
      return rows;
    }

    // ë‚ ì§œ íŒŒì‹± (YYYY-MM-DD / YYYY.MM.DD ë“± ì§€ì›) â†’ ìˆ«ì(íƒ€ì„ìŠ¤íƒ¬í”„)
    function parseDateToTime(str){
      if(!str) return 0;
      const m = str.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
      if(!m) return 0;
      const y = m[1];
      const mo = m[2].padStart(2,"0");
      const d = m[3].padStart(2,"0");
      const dt = new Date(`${y}-${mo}-${d}`);
      const t = dt.getTime();
      return isNaN(t) ? 0 : t;
    }

    // ì´ë¯¸ì§€ ì…€ â†’ ë°°ì—´ (ì¤„ë°”ê¿ˆ ë˜ëŠ” ì‰¼í‘œ ê¸°ì¤€)
    function parseImages(cell){
      if(!cell) return [];
      return cell
        .split(/[\n,]/)
        .map(s=>s.trim())
        .filter(Boolean);
    }

    // ê°„ë‹¨ ë§ˆí¬ë‹¤ìš´ â†’ HTML + URL ë§í¬ ì²˜ë¦¬
    function markdownToHtml(src){
      if(!src) return "";

      let html = src
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;");

      // [í…ìŠ¤íŠ¸](https://...)
      html = html.replace(
        /\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,
        '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'
      );

      // **êµµê²Œ**
      html = html.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>");

      // *ê¸°ìš¸ì„*
      html = html.replace(/\*([^*]+)\*/g,"<em>$1</em>");

      // ì¼ë°˜ URL ìë™ ë§í¬
      html = html.replace(
        /(^|[^"'])(https?:\/\/[^\s<]+)/g,
        '$1<a href="$2" target="_blank" rel="noopener noreferrer">$2</a>'
      );

      // ì¤„ë°”ê¿ˆ â†’ <br>
      html = html.replace(/\r\n|\r|\n/g,"<br>");

      return html;
    }

    // ===== ê³µì§€ ë¶ˆëŸ¬ì˜¤ê¸° =====
    async function loadNotices(){
      try{
        const res = await fetch(NOTICE_CSV_URL);
        const text = await res.text();
        const rows = parseCSV(text);
        if(!rows.length) return;

        const headers = rows[0].map(h=>h.trim());
        const dataRows = rows.slice(1);

        const colIndex = {
          type: headers.findIndex(h => h.includes("êµ¬ë¶„") || h.includes("ë¶„ë¥˜") || h.toLowerCase().includes("type")),
          title: headers.findIndex(h => h.includes("ì œëª©") || h.toLowerCase().includes("title")),
          date: headers.findIndex(h => h.includes("ë‚ ì§œ") || h.includes("ë“±ë¡ì¼") || h.toLowerCase().includes("date")),
          url:  headers.findIndex(h => h.toLowerCase().includes("url") || h.includes("ë§í¬")),
          content: headers.findIndex(h =>
            h.includes("ë‚´ìš©") || h.includes("ìƒì„¸") ||
            h.toLowerCase().includes("content") || h.toLowerCase().includes("body")
          ),
          image: headers.findIndex(h =>
            h.includes("ì´ë¯¸ì§€") || h.toLowerCase().includes("image") || h.toLowerCase().includes("poster")
          )
        };

        NOTICES = dataRows
          .filter(r => r[colIndex.title] && r[colIndex.title].trim() !== "")
          .map(r => {
            const dateStr = colIndex.date >= 0 ? (r[colIndex.date] || "").trim() : "";
            return {
              type: colIndex.type >= 0 ? (r[colIndex.type] || "").trim() : "ê³µì§€",
              title: (r[colIndex.title] || "").trim(),
              date: dateStr,
              url:  colIndex.url  >= 0 ? (r[colIndex.url]   || "").trim() : "",
              content: colIndex.content >= 0 ? (r[colIndex.content] || "").trim() : "",
              images: colIndex.image >= 0 ? parseImages(r[colIndex.image]) : [],
              time: parseDateToTime(dateStr)
            };
          });

        // âœ… ë‚ ì§œ ê¸°ì¤€ ìµœì‹ ìˆœ ì •ë ¬
        NOTICES.sort((a,b)=> (b.time || 0) - (a.time || 0));

        buildTypeFilter();
        applyNoticeFilter();
      }catch(err){
        console.error("ê³µì§€ì‚¬í•­ ë¡œë”© ì˜¤ë¥˜:", err);
        const tbody = document.getElementById("notice-tbody");
        tbody.innerHTML = `
          <tr><td colspan="3" class="notice-empty">
            ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.
          </td></tr>
        `;
      }
    }

    // íƒ€ì… í•„í„° ì˜µì…˜ êµ¬ì„±
    function buildTypeFilter(){
      const select = document.getElementById("notice-type-filter");
      if(!select) return;

      const types = Array.from(new Set(
        NOTICES.map(n => n.type && n.type.trim() ? n.type.trim() : "ê¸°íƒ€")
      ));

      select.innerHTML = "";
      const allOpt = document.createElement("option");
      allOpt.value = "ì „ì²´";
      allOpt.textContent = "êµ¬ë¶„ ì „ì²´";
      select.appendChild(allOpt);

      types.forEach(t=>{
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        select.appendChild(opt);
      });

      select.value = "ì „ì²´";
    }

    // ê²€ìƒ‰/í•„í„° ì ìš© í›„ ëª©ë¡ ê³„ì‚°
    function applyNoticeFilter(){
      const keyword = (currentKeyword || "").toLowerCase();
      FILTERED_NOTICES = NOTICES.filter(n => {
        const typeOk = currentTypeFilter === "ì „ì²´" || n.type === currentTypeFilter;
        if(!typeOk) return false;

        if(!keyword) return true;

        const target = (n.title + " " + (n.content || "")).toLowerCase();
        return target.includes(keyword);
      });

      currentPage = 1; // í•„í„° ë°”ë€” ë•ŒëŠ” 1í˜ì´ì§€ë¡œ
      renderNoticeTable();
    }

    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    function renderPagination(totalPages){
      const wrap = document.getElementById("notice-pagination");
      if(!wrap) return;

      if(totalPages <= 1){
        wrap.style.display = "none";
        wrap.innerHTML = "";
        return;
      }
      wrap.style.display = "flex";

      wrap.innerHTML = `
        <button type="button" class="notice-page-btn" id="notice-prev">ì´ì „</button>
        <span class="notice-page-info">${currentPage} / ${totalPages}</span>
        <button type="button" class="notice-page-btn" id="notice-next">ë‹¤ìŒ</button>
      `;

      const prevBtn = document.getElementById("notice-prev");
      const nextBtn = document.getElementById("notice-next");

      if(currentPage <= 1){
        prevBtn.disabled = true;
      }
      if(currentPage >= totalPages){
        nextBtn.disabled = true;
      }

      prevBtn.addEventListener("click", ()=>{
        if(currentPage > 1){
          currentPage--;
          renderNoticeTable();
        }
      });
      nextBtn.addEventListener("click", ()=>{
        if(currentPage < totalPages){
          currentPage++;
          renderNoticeTable();
        }
      });
    }

    // í…Œì´ë¸” ë Œë”ë§ (10ê°œì”© í˜ì´ì§€)
    function renderNoticeTable(){
      const tbody = document.getElementById("notice-tbody");
      if(!tbody) return;

      const total = FILTERED_NOTICES.length;
      if(!total){
        tbody.innerHTML = `
          <tr><td colspan="3" class="notice-empty">
            ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.
          </td></tr>
        `;
        renderPagination(0);
        return;
      }

      const totalPages = Math.ceil(total / PAGE_SIZE);
      if(currentPage > totalPages) currentPage = totalPages;

      const start = (currentPage - 1) * PAGE_SIZE;
      const end = start + PAGE_SIZE;
      const pageItems = FILTERED_NOTICES.slice(start, end);

      tbody.innerHTML = "";
      pageItems.forEach((n, idx)=>{
        const realIndex = start + idx; // FILTERED_NOTICES ìƒì˜ ì¸ë±ìŠ¤
        const tr = document.createElement("tr");
        tr.className = "notice-row";
        tr.dataset.index = realIndex;

        tr.innerHTML = `
          <td class="notice-type">${n.type || "ê³µì§€"}</td>
          <td class="notice-title">${n.title}</td>
          <td class="notice-date">${n.date}</td>
        `;
        tbody.appendChild(tr);
      });

      renderPagination(totalPages);
    }

    // ====== ëª¨ë‹¬ ê´€ë ¨ ======
    const modal = document.getElementById("noticeModal");
    const modalTitle = document.getElementById("modal-title");
    const modalType = document.getElementById("modal-type");
    const modalDate = document.getElementById("modal-date");
    const modalContent = document.getElementById("modal-content");
    const modalLink = document.getElementById("modal-link");
    const modalCloseBtn = document.getElementById("modal-close-btn");

    const modalImages = document.getElementById("modal-images");
    const modalImg = document.getElementById("modal-img");
    const modalImgIndicator = document.getElementById("modal-img-indicator");
    const modalImgPrev = document.getElementById("modal-img-prev");
    const modalImgNext = document.getElementById("modal-img-next");

    function showCurrentImage(){
      if(!currentImages || !currentImages.length){
        modalImages.style.display = "none";
        return;
      }
      modalImages.style.display = "flex";
      modalImg.src = currentImages[currentImageIndex];
      modalImgIndicator.textContent = `${currentImageIndex + 1} / ${currentImages.length}`;
    }

    function openModalByIndex(idx){
      const n = FILTERED_NOTICES[idx];
      if(!n) return;

      modalTitle.textContent = n.title || "";
      modalType.textContent = n.type || "ê³µì§€";
      modalDate.textContent = n.date || "";

      const html = markdownToHtml(n.content);
      modalContent.innerHTML = html || "ìƒì„¸ ë‚´ìš©ì´ ë³„ë„ë¡œ ë“±ë¡ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.";

      // ë§í¬ ë²„íŠ¼
      if(n.url){
        modalLink.style.display = "inline-flex";
        modalLink.href = n.url;
      }else{
        modalLink.style.display = "none";
      }

      // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ì„¸íŒ…
      currentImages = n.images || [];
      currentImageIndex = 0;
      showCurrentImage();

      modal.classList.add("is-open");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      modal.classList.remove("is-open");
      document.body.style.overflow = "";
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      loadNotices();

      const tbody = document.getElementById("notice-tbody");
      const searchInput = document.getElementById("notice-search-input");
      const typeSelect = document.getElementById("notice-type-filter");

      // ë¦¬ìŠ¤íŠ¸ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ê¸°
      tbody.addEventListener("click", (e)=>{
        const tr = e.target.closest(".notice-row");
        if(!tr) return;
        const idx = Number(tr.dataset.index);
        openModalByIndex(idx);
      });

      // ê²€ìƒ‰
      if(searchInput){
        searchInput.addEventListener("input", (e)=>{
          currentKeyword = e.target.value.trim();
          applyNoticeFilter();
        });
      }

      // íƒ€ì… í•„í„°
      if(typeSelect){
        typeSelect.addEventListener("change", (e)=>{
          currentTypeFilter = e.target.value;
          applyNoticeFilter();
        });
      }

      // ëª¨ë‹¬ ë‹«ê¸°
      modalCloseBtn.addEventListener("click", closeModal);
      modal.querySelector(".modal-overlay").addEventListener("click", closeModal);
      document.addEventListener("keydown", (e)=>{
        if(e.key === "Escape" && modal.classList.contains("is-open")){
          closeModal();
        }
      });

      // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ë²„íŠ¼
      if(modalImgPrev){
        modalImgPrev.addEventListener("click", ()=>{
          if(!currentImages.length) return;
          currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
          showCurrentImage();
        });
      }
      if(modalImgNext){
        modalImgNext.addEventListener("click", ()=>{
          if(!currentImages.length) return;
          currentImageIndex = (currentImageIndex + 1) % currentImages.length;
          showCurrentImage();
        });
      }
    });
  </script>
</body>
</html>
